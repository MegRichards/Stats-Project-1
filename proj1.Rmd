---
title: "Statisitcal Programming - 2020 - Project 1"
output: rmarkdown::html_document
author: Add your name here
---

Due on Monday, November 2nd by 5:00 pm (17:00), UK local time.

Before you start be sure to read through *all* of the rules and instructions in the `README.md`.

<br/>

### Data

```{r}
library(tidyverse)
f1 = readRDS(file="data/f1.rds")
```


<br/>

### Task 1 - Tidy the data

#### Write up

<!-- Include write up here --> #think you can use transmute to keep only new variables, rather than using mutate and then unselecting?

#### Code

```{r task1}
f1_tidy = f1 %>%
  tibble::tibble(f1 = .) %>%
  hoist(
    f1, 
    MRData = c("MRData")
  )%>%
  hoist(
    MRData,
    table = c("RaceTable")
  )%>%
  select(-MRData)%>%
  hoist(
    table,
    races = c("Races")
  )%>%
  select(-table)%>%
  unnest_longer(races)%>%
  hoist(
    races,
    race_name = c("raceName"),
    round = c("round"),
    date = c("date"),
    results = c("Results")
  )%>%
  mutate(date = as.Date(date))%>%
  mutate(round = as.integer(round))%>%
  select(-races)%>%
  unnest_longer(results)%>%
  hoist(
    results,
    driver_info = c("Driver"),
    constructor_info = c("Constructor"),
    position = c("positionText"),
    points = c("points")
  )%>%
  mutate(position = na_if(position, "R"))%>%
  mutate(position = na_if(position, "W"))%>%
  mutate(position = na_if(position, "D"))%>%
  mutate(position = na_if(position, "E"))%>%
  mutate(position = na_if(position, "F"))%>%
  mutate(position = na_if(position, "N"))%>%
  mutate(position = as.integer(position))%>%
  mutate(points = as.integer(points))%>%
  select(-results)%>%
  hoist(
    driver_info,
    first_name = c("givenName"),
    surname = c("familyName")
  )%>%
  select(-driver_info)%>%
  hoist(
    constructor_info,
    constructor = c("name")
  )%>%
  select(-constructor_info)%>%
  mutate(driver = paste(first_name, surname, sep=" "))%>%
  select(-first_name, -surname)%>%
  relocate(race_name, round, date, driver)

head(f1_tidy, 10)
```

<br/>


### Task 2 - Drivers' Championship

#### Write up

<!-- Include write up here -->

#### Code

```{r task2}
f1_tidy%>%
  select(driver, race_name, position)%>% #use round instead of race_name?
  mutate(points = case_when(
    position > 10 ~ 0,
    position > 9 ~ 1,
    position > 3 ~ ((10 - position)*2),
    position > 2 ~ 15, 
    position > 1 ~ 18,
    position == 1 ~ 26,
    TRUE ~ 0))%>%
  group_by(driver) %>%
  mutate(overall_points = sum(points))%>%
  select(-points)%>%
  mutate(overall_points = as.integer(overall_points))%>%
  pivot_wider(
    names_from = race_name, 
    values_from = position
  )%>%
  arrange(desc(overall_points))%>%
  relocate(c("overall_points"), .after = last_col())
  
```
```{r tidy2}

f1_tidy%>%
  select(driver, race_name, position)%>%
  pivot_wider(
    names_from = race_name, 
    values_from = position
  )

```
<br/>

### Task 3 - Cumulative Constructors

#### Write up

<!-- Include write up here -->

#### Code

```{r task3}
  
f1_tidy%>%
  select(constructor, round, position)%>%
  mutate(points = case_when(
    position > 10 ~ 0,
    position > 9 ~ 1,
    position > 3 ~ ((10 - position)*2),
    position > 2 ~ 15, 
    position > 1 ~ 18,
    position == 1 ~ 26,
    TRUE ~ 0))%>%
  select(-position)%>%
  pivot_wider(
    names_from = round, 
    values_from = points
  )%>%
  summarise_if(is.list, sum_list, na.rm = TRUE)

  
```

<br/>

### Task 4 - Visualization

#### Write up

<!-- Include write up here -->

#### Code

```{r task4}

```

<br/>

